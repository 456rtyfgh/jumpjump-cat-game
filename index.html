<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cat Run 3D Pro</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
    #ui {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-family: sans-serif;
      z-index: 10;
      text-align: center;
    }
    #ui h1 { margin: 0; font-size: 24px; }
    #ui p { margin: 5px 0; }
    #startBtn, #restartBtn {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <div id="ui">
    <h1>Cat Run 3D</h1>
    <p id="score">Score: 0</p>
    <button id="startBtn">Start Game</button>
    <button id="restartBtn" style="display:none;">Restart</button>
  </div>
  <audio id="bgm" src="https://cdn.pixabay.com/audio/2022/12/01/audio_c99562ab0d.mp3" loop></audio>
  <audio id="pickup" src="https://cdn.pixabay.com/audio/2022/03/15/audio_7d07b221e3.mp3"></audio>
  <audio id="gameover" src="https://cdn.pixabay.com/audio/2021/08/04/audio_d5ba63f579.mp3"></audio>

  <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/loaders/GLTFLoader.js"></script>
  <script>
    let scene, camera, renderer, clock;
    let cat, floor, obstacles = [], fishes = [];
    let moveX = 0, score = 0, speed = 0.15, running = false;
    const loader = new THREE.GLTFLoader();

    function init() {
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0xaed9f4);

      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 4, 6);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(5, 10, 5);
      scene.add(light);
      scene.add(new THREE.AmbientLight(0x404040));

      const floorGeo = new THREE.PlaneGeometry(20, 1000);
      const floorMat = new THREE.MeshStandardMaterial({ color: 0x4caf50 });
      floor = new THREE.Mesh(floorGeo, floorMat);
      floor.rotation.x = -Math.PI / 2;
      scene.add(floor);

      loader.load('https://models.babylonjs.com/Cat.glb', function(gltf) {
        cat = gltf.scene;
        cat.scale.set(0.8, 0.8, 0.8);
        cat.position.set(0, 0, 0);
        scene.add(cat);
      });

      for (let i = 0; i < 10; i++) createObstacle(i);
      for (let i = 0; i < 5; i++) createFish(i);

      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      document.addEventListener('keydown', (e) => {
        if (e.code === 'ArrowLeft') moveX = -2;
        if (e.code === 'ArrowRight') moveX = 2;
      });
      document.addEventListener('keyup', () => moveX = 0);

      document.getElementById('startBtn').onclick = () => {
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('bgm').play();
        running = true;
        clock = new THREE.Clock();
        animate();
      };

      document.getElementById('restartBtn').onclick = () => location.reload();
    }

    function createObstacle(index) {
      const obGeo = new THREE.BoxGeometry(1, 1, 1);
      const obMat = new THREE.MeshStandardMaterial({ color: 0xff0000 });
      const ob = new THREE.Mesh(obGeo, obMat);
      ob.position.set((Math.random() - 0.5) * 6, 0.5, -index * 10);
      scene.add(ob);
      obstacles.push(ob);
    }

    function createFish(index) {
      const fishGeo = new THREE.TetrahedronGeometry(0.3);
      const fishMat = new THREE.MeshStandardMaterial({ color: 0xffcc00 });
      const fish = new THREE.Mesh(fishGeo, fishMat);
      fish.position.set((Math.random() - 0.5) * 6, 0.3, -index * 20 - 15);
      scene.add(fish);
      fishes.push(fish);
    }

    function animate() {
      if (!running || !cat) return;
      requestAnimationFrame(animate);
      const delta = clock.getDelta();

      cat.position.z -= speed * 60 * delta;
      cat.position.x += (moveX - cat.position.x) * 0.2;

      camera.position.z = cat.position.z + 6;
      camera.lookAt(cat.position.x, cat.position.y, cat.position.z);
      floor.position.z = cat.position.z - 10;

      obstacles.forEach((ob) => {
        if (ob.position.z > cat.position.z + 2) {
          ob.position.z -= 100;
          ob.position.x = (Math.random() - 0.5) * 6;
          score++;
          document.getElementById('score').innerText = `Score: ${score}`;
          if (score % 10 === 0) speed += 0.01;
        }
        if (Math.abs(cat.position.z - ob.position.z) < 1 && Math.abs(cat.position.x - ob.position.x) < 1) {
          running = false;
          document.getElementById('bgm').pause();
          document.getElementById('gameover').play();
          document.getElementById('restartBtn').style.display = 'inline';
          alert(`Game Over! Final Score: ${score}`);
        }
      });

      fishes.forEach((fish, i) => {
        if (Math.abs(cat.position.z - fish.position.z) < 1 && Math.abs(cat.position.x - fish.position.x) < 1) {
          document.getElementById('pickup').play();
          scene.remove(fish);
          fishes.splice(i, 1);
          score += 5;
          document.getElementById('score').innerText = `Score: ${score}`;
        }
      });

      renderer.render(scene, camera);
    }

    init();
  </script>
</body>
</html>
